import type { Mastra } from '../../index.js';
import type { AgentExecutionOptions } from '../../agent/index.js';
import type { MultiPrimitiveExecutionOptions, NetworkOptions } from '../../agent/agent.types.js';
import { Agent } from '../../agent/index.js';
import type { MessageListInput } from '../../agent/message-list/index.js';
import type { StructuredOutputOptions } from '../../agent/types.js';
import type { TracingContext } from '../../observability/index.js';
import { ProcessorRunner } from '../../processors/runner.js';
import type { RequestContext } from '../../request-context/index.js';
import { MastraAgentNetworkStream } from '../../stream/MastraAgentNetworkStream.js';
import type { IdGeneratorContext } from '../../types/index.js';
import type { Step } from '../../workflows/index.js';
import type { CompletionConfig } from './validation.js';
/**
 * Type for ID generator function that can optionally accept context
 */
type NetworkIdGenerator = (context?: IdGeneratorContext) => string;
/** @internal Exported for testing purposes */
export declare function getRoutingAgent({ requestContext, agent, routingConfig, }: {
    agent: Agent;
    requestContext: RequestContext;
    routingConfig?: {
        additionalInstructions?: string;
    };
}): Promise<Agent<"routing-agent", import("../../agent").ToolsInput, undefined, unknown>>;
export declare function getLastMessage(messages: MessageListInput): string;
export declare function prepareMemoryStep({ threadId, resourceId, messages, routingAgent, requestContext, generateId, tracingContext, memoryConfig, }: {
    threadId: string;
    resourceId: string;
    messages: MessageListInput;
    routingAgent: Agent;
    requestContext: RequestContext;
    generateId: NetworkIdGenerator;
    tracingContext?: TracingContext;
    memoryConfig?: any;
}): Promise<{
    thread: import("../../memory").StorageThreadType | undefined;
}>;
export declare function createNetworkLoop({ networkName, requestContext, runId, agent, generateId, routingAgentOptions, routing, onAbort, abortSignal, }: {
    networkName: string;
    requestContext: RequestContext;
    runId: string;
    agent: Agent;
    routingAgentOptions?: Pick<MultiPrimitiveExecutionOptions, 'modelSettings'>;
    generateId: NetworkIdGenerator;
    routing?: {
        additionalInstructions?: string;
        verboseIntrospection?: boolean;
    };
    onAbort?: (event: any) => Promise<void> | void;
    abortSignal?: AbortSignal;
}): Promise<{
    networkWorkflow: import("../../workflows").Workflow<import("../../workflows").DefaultEngineType, Step<string, unknown, unknown, unknown, unknown, unknown, any, unknown>[], "Agent-Network-Outer-Workflow", unknown, {
        task: string;
        primitiveId: string;
        primitiveType: "tool" | "none" | "workflow" | "agent";
        iteration: number;
        isOneOff: boolean;
        verboseIntrospection: boolean;
        threadId?: string | undefined;
        result?: string | undefined;
        threadResourceId?: string | undefined;
    }, {
        result: string;
        prompt: string;
        task: string;
        primitiveId: string;
        primitiveType: "tool" | "none" | "workflow" | "agent";
        iteration: number;
        isOneOff: boolean;
        threadId?: string | undefined;
        completionReason?: string | undefined;
        isComplete?: boolean | undefined;
        threadResourceId?: string | undefined;
    }, {
        task: string;
        primitiveId: string;
        primitiveType: "tool" | "none" | "workflow" | "agent";
        iteration: number;
        isOneOff: boolean;
        verboseIntrospection: boolean;
        threadId?: string | undefined;
        result?: string | undefined;
        threadResourceId?: string | undefined;
    }, unknown>;
    processorRunner: ProcessorRunner | null;
}>;
export declare function networkLoop<OUTPUT = undefined>({ networkName, requestContext, runId, routingAgent, routingAgentOptions, generateId, maxIterations, threadId, resourceId, messages, validation, routing, onIterationComplete, resumeData, autoResumeSuspendedTools, mastra, structuredOutput, onAbort, abortSignal, }: {
    networkName: string;
    requestContext: RequestContext;
    runId: string;
    routingAgent: Agent<any, any, any, any>;
    routingAgentOptions?: AgentExecutionOptions<OUTPUT>;
    generateId: NetworkIdGenerator;
    maxIterations: number;
    threadId?: string;
    resourceId?: string;
    messages: MessageListInput;
    /**
     * Completion checks configuration.
     * When provided, runs checks to verify task completion.
     */
    validation?: CompletionConfig;
    /**
     * Optional routing configuration to customize primitive selection behavior.
     */
    routing?: {
        additionalInstructions?: string;
        verboseIntrospection?: boolean;
    };
    /**
     * Optional callback fired after each iteration completes.
     */
    onIterationComplete?: (context: {
        iteration: number;
        primitiveId: string;
        primitiveType: 'agent' | 'workflow' | 'tool' | 'none';
        result: string;
        isComplete: boolean;
    }) => void | Promise<void>;
    /**
     * Structured output configuration for the network's final result.
     * When provided, generates a structured response matching the schema.
     */
    structuredOutput?: OUTPUT extends {} ? StructuredOutputOptions<OUTPUT> : never;
    resumeData?: any;
    autoResumeSuspendedTools?: boolean;
    mastra?: Mastra;
    onAbort?: NetworkOptions<OUTPUT>['onAbort'];
    abortSignal?: NetworkOptions<OUTPUT>['abortSignal'];
}): Promise<MastraAgentNetworkStream<OUTPUT>>;
export {};
//# sourceMappingURL=index.d.ts.map